services:
  web:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.prod
      args:
        NEXT_PUBLIC_BASE_URL: ${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}
      # Increase build memory limit to prevent OOM kills during Next.js build
      shm_size: '2gb'
    restart: always
    container_name: inbox-zero-web
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - DIRECT_URL=${DIRECT_URL}
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
      - AUTH_SECRET=${AUTH_SECRET}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - EMAIL_ENCRYPT_SECRET=${EMAIL_ENCRYPT_SECRET}
      - EMAIL_ENCRYPT_SALT=${EMAIL_ENCRYPT_SALT}
      - GOOGLE_PUBSUB_TOPIC_NAME=${GOOGLE_PUBSUB_TOPIC_NAME}
      - GOOGLE_PUBSUB_VERIFICATION_TOKEN=${GOOGLE_PUBSUB_VERIFICATION_TOKEN}
      - MICROSOFT_CLIENT_ID=${MICROSOFT_CLIENT_ID}
      - MICROSOFT_CLIENT_SECRET=${MICROSOFT_CLIENT_SECRET}
      - MICROSOFT_WEBHOOK_CLIENT_STATE=${MICROSOFT_WEBHOOK_CLIENT_STATE}
      - DEFAULT_LLM_PROVIDER=${DEFAULT_LLM_PROVIDER}
      - DEFAULT_LLM_MODEL=${DEFAULT_LLM_MODEL}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - ECONOMY_LLM_PROVIDER=${ECONOMY_LLM_PROVIDER}
      - ECONOMY_LLM_MODEL=${ECONOMY_LLM_MODEL}
      - INTERNAL_API_KEY=${INTERNAL_API_KEY}
      - API_KEY_SALT=${API_KEY_SALT}
      - REDIS_URL=${REDIS_URL:-redis://localhost:6379}
      - QSTASH_TOKEN=${QSTASH_TOKEN}
      - QSTASH_CURRENT_SIGNING_KEY=${QSTASH_CURRENT_SIGNING_KEY}
      - QSTASH_NEXT_SIGNING_KEY=${QSTASH_NEXT_SIGNING_KEY}
      - NEXT_PUBLIC_APP_HOME_PATH=${NEXT_PUBLIC_APP_HOME_PATH}
      - LOG_ZOD_ERRORS=${LOG_ZOD_ERRORS}
      - CRON_SECRET=${CRON_SECRET}
      - TINYBIRD_TOKEN=${TINYBIRD_TOKEN}
      - TINYBIRD_BASE_URL=${TINYBIRD_BASE_URL}
      - TINYBIRD_ENCRYPT_SECRET=${TINYBIRD_ENCRYPT_SECRET}
      - TINYBIRD_ENCRYPT_SALT=${TINYBIRD_ENCRYPT_SALT}
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
      - SENTRY_ORGANIZATION=${SENTRY_ORGANIZATION}
      - SENTRY_PROJECT=${SENTRY_PROJECT}
      - NEXT_PUBLIC_SENTRY_DSN=${NEXT_PUBLIC_SENTRY_DSN}
      - NEXT_PUBLIC_AXIOM_DATASET=${NEXT_PUBLIC_AXIOM_DATASET}
      - NEXT_PUBLIC_AXIOM_TOKEN=${NEXT_PUBLIC_AXIOM_TOKEN}
      - NEXT_PUBLIC_POSTHOG_KEY=${NEXT_PUBLIC_POSTHOG_KEY}
      - NEXT_PUBLIC_POSTHOG_HERO_AB=${NEXT_PUBLIC_POSTHOG_HERO_AB}
      - NEXT_PUBLIC_POSTHOG_ONBOARDING_SURVEY_ID=${NEXT_PUBLIC_POSTHOG_ONBOARDING_SURVEY_ID}
      - POSTHOG_API_SECRET=${POSTHOG_API_SECRET}
      - POSTHOG_PROJECT_ID=${POSTHOG_PROJECT_ID}
      - RESEND_API_KEY=${RESEND_API_KEY}
      - LOOPS_API_SECRET=${LOOPS_API_SECRET}
      - NEXT_PUBLIC_CRISP_WEBSITE_ID=${NEXT_PUBLIC_CRISP_WEBSITE_ID}
      - ADMINS=${ADMINS}
